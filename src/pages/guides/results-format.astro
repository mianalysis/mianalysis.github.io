---
import AnchoredHeading from '@/components/layout/AnchoredHeading.astro';
import GuideLayout from '@/layouts/GuideLayout.astro';
---

<GuideLayout>
  <div class="mx-auto max-w-4xl space-y-16">
    <section class="space-y-4">
      <h1>Results Format</h1>

      <p class="text-2xl opacity-70">
        Description of the default output results (<code>.xlsx</code>) format
      </p>
    </section>

    <section class="space-y-4">
      <AnchoredHeading type="h2" text="Introduction" />

      <p>
        Numeric results generated by MIA workflows are exported to Excel spreadsheets. By default,
        each time a workflow is run, the results for all images processed will be collected into a
        single spreadsheet, however, this behaviour can be changed such that each input file
        generates its own spreadsheet.
      </p>

      <p>
        Output results files can contain multiple, highly configurable sheets. Typically, a results
        file will include a summary sheet with one row per input image, individual object sheets
        with one row per detected object and a couple of record-keeping sheets.
      </p>

      <p>
        The output file format is configured in the
        <a class="link" href="/modules/core/output-control"> Output control </a>
        module.
      </p>
    </section>

    <section class="space-y-4">
      <AnchoredHeading type="h2" text="Summary sheet" />

      <ul>
        <li>
          The summary sheet is intended to provide a quick overview of the measurements contained
          within the individual object sheets. Information is broken down into four classes of
          column.
          <ul>
            <li>
              By default, each row of the summary sheet will summarise the results from a single
              input image.
            </li>
            <li>
              By changing the "Summary mode" parameter of the "Output control" module to "Per
              timepoint per input file", a new row can be generated for each timepoint in the image,
              allowing for quick analysis of time-dependent processes.
            </li>
            <li>
              Alternatively, by setting this to "Group by metadata", results can be grouped by a
              specific metadata item, with one row per unique metadata value.
            </li>
          </ul>
        </li>

        <li>
          Metadata values:
          <ul>
            <li>Record input file-specified properties, such as filenames and series numbers.</li>
            <li>
              These are important for result filtering and sorting, since results from multiple
              files may be included in a single results file.
            </li>
            <li>Column headings simply state the name of the metadata item.</li>
            <li>
              Metadata columns can be enabled/disabled using the "Ind" controls in the "Output
              control" module.
            </li>
          </ul>
        </li>

        <li>
          Image measurements:
          <ul>
            <li>These columns record the individual measurements assigned to each object.</li>
            <li>
              Columns headings are in the form:
              <code>[Image name]_(IM) // [Measurement name]</code>
            </li>
            <li>
              For example, an image called "Binary" with the measurement "THRESHOLD // GLOBAL Huang"
              would be called "Binary_(IM) // THRESHOLD // GLOBAL Huang".
            </li>
            <li>
              Image measurements columns can be enabled/disabled using the "Ind" controls in the
              "Output control" module.
            </li>
          </ul>
        </li>

        <li>
          Object counts:
          <ul>
            <li>These simply state the number of objects of the specified class.</li>
            <li>
              These have headers in the form:
              <code>[Objects name]_(OBJ) // NUMBER</code>
            </li>
            <li>
              For example, for the count of detected "Nuclei" objects, this would be "Nuclei_(OBJ)
              // NUMBER".
            </li>
            <li>
              Object count columns can be enabled/disabled using the "Show object counts" control in
              the "Output control" module. Object counts are either on or off for all objects.
            </li>
          </ul>
        </li>

        <li>
          Object measurement statistics:
          <ul>
            <li>
              Since multiple objects may be detected for an input file, each with their own
              measurements, these columns provide a single summary measurement statistic.
            </li>
            <li>
              Headers for these values are in the form:
              <code>[Objects name]_(OBJ_[Statistic]) // [Measurement name]</code>
            </li>
            <li>
              For example, the header corresponding to the mean of the "SHAPE // N_VOXELS"
              measurement for "Nuclei" objects would be "Nuclei_(OBJ_MEAN) // SHAPE // N_VOXELS".
            </li>
            <li>
              Supported statistics are the mean ("MEAN"), minimum ("MIN"), maximum ("MAX"), standard
              deviation ("STD") and sum ("SUM").
            </li>
            <li>
              Object measurement statistic columns can be enabled/disabled using the "Mean", "Min",
              "Max", "Sum" and "Std" controls in the "Output control" module. The "Ind" control
              determines if the measurement appears in the object-specific results sheet.
            </li>
          </ul>
        </li>
      </ul>
    </section>

    <section class="space-y-4">
      <AnchoredHeading type="h2" text="Object sheets" />

      <ul>
        <li>
          The individual object sheets include the individual measurements for each detected object.
          Each row of an object results sheet corresponds to a single detected object.
        </li>

        <li>
          The first column is always ("OBJECT_ID"), which is the unique ID number for that object in
          that analysis run.
          <ul>
            <li>
              Note: IDs are only unique to that analysis run, so if multiple input files were
              processed, the same ID numbers will likely appear.
            </li>
          </ul>
        </li>

        <li>
          As with the summary sheet, each row has columns for file-specific metadata items as well
          as a column for each exported measurement.
        </li>

        <li>
          Metadata and measurement columns can be disabled with the "Ind" controls in the "Output
          control" module.
        </li>
      </ul>
    </section>

    <section class="space-y-4">
      <AnchoredHeading type="h2" text="Record-keeping sheets" />

      <ul>
        <li>
          The final two sheets are always record-keeping sheets. These are useful for retaining
          knowledge of how a workflow was run (e.g. plugin version) as well as seeing if any errors
          occurred during execution.
        </li>

        <li>
          The "Configuration" sheet includes some device-specific information such as the computer
          operating system, plugin version and date/time of execution. It also includes a full copy
          of the .mia workflow file used. In the event of the workflow file being lost, these rows
          can be copied into a text file and saved with the .mia extension.
        </li>

        <li>
          The "Log" sheet contains a list of any error messages encountered during the analysis run.
          All being well, this sheet should be empty.
        </li>
      </ul>
    </section>
  </div>
</GuideLayout>
