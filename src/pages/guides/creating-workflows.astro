---
import MiaIcon from '@/components/MiaIcon.astro';
import StaticVideo from '@/components/StaticVideo.astro';
import YouTubeVideo from '@/components/YouTubeVideo.astro';
import AnchoredHeading from '@/components/layout/AnchoredHeading.astro';
import GuideLayout from '@/layouts/GuideLayout.astro';
---

<GuideLayout>
  <div class="mx-auto max-w-4xl space-y-16">
    <section class="space-y-4">
      <h1>Creating Workflows</h1>

      <p class="text-2xl opacity-70">Creating a new workflow from scratch</p>
    </section>

    <section class="space-y-4">
      <AnchoredHeading type="h2" text="Introduction" />

      <p>
        Workflows can be created and edited from
        <a class="link" href="/guides/editing-view"> editing view </a>
        . Modules are assembled into a linear sequence that forms the workflow. Each module has its own
        independent set of parameters which can be configured by selecting that module from the workflow
        list. Images and objects created by modules are available to subsequent modules in the workflow,
        as are other items such as measurements, metadata and object relationships.
      </p>

      <p>
        In this guide we will cover adding modules, setting the input file, configuring modules,
        configuring output Excel formats and setting parameters to be visible in
        <a class="link" href="/guides/processing-view"> processing view </a>
        .
      </p>

      <p>
        If you haven't already done so, at this point it's also worth looking at the
        <a class="link" href="/guides/example-workflows"> example workflows </a>
        . These workflows include key modules used in the majority of analyses, each of which has accompanying
        notes, explaining its configuration.
      </p>

      <YouTubeVideo id="CfpWGBpZxEo" />
    </section>

    <section class="space-y-4">
      <AnchoredHeading type="h2" text="Accessing editing view" />

      <ul>
        <li>
          By default, MIA will open in
          <a class="link" href="/guides/processing-view"> processing view </a>
          . To switch to editing view, select "View {'>'} Switch to editing view" from the MIA menu.
          <ul>
            <li>
              The layout of editing view is covered in the
              <a class="link" href="/guides/editing-view"> editing view </a>
              guide.
            </li>
          </ul>
        </li>
      </ul>

      <StaticVideo url="https://assets.jdjfisher.dev/mia/guides/new-workflow/switch_view.mp4" />
    </section>

    <section class="space-y-4">
      <AnchoredHeading type="h2" text="Adding and arranging modules" />

      <ul>
        <li>
          A list of available modules can be viewed by clicking the + button in the top-left corner
          of the MIA interface.
          <ul>
            <li>Modules are grouped into general categories and sub-categories.</li>
            <li>To view a description of each module, hover the mouse over its name.</li>
            <li>
              Full documentation of each module can be found in the
              <a class="link" href="/modules"> Modules </a>
              pages.
            </li>
          </ul>
        </li>

        <li>
          Click a module to add it to current workflow.
          <ul>
            <li>
              If any modules in the current workflow are selected, the new module will be inserted
              immediately after them. Otherwise, it will be added to the bottom of the list.
            </li>
          </ul>
        </li>

        <li>
          Modules can also be discovered and added using the module search feature.
          <ul>
            <li>
              Access search via either the menu bar ("View {'>'} Show module search") or by clicking
              "Search for module" in the available module list.
            </li>
            <li>
              Search will always match modules based on the module name, but can optionally be set
              to also search in the module and/or parameter descriptions using the "Include
              module/parameter descriptions" checkboxes.
            </li>
            <li>
              Detected modules need only match one search word; however, mandatory words can be
              specified using quotation marks.
            </li>
            <li>Add detected modules to the current workflow using the + button to their right.</li>
          </ul>
        </li>

        <li>
          Selected module(s) can be removed using the - button and moved up and down with the ? and
          ? buttons.
          <ul>
            <li>Modules can also be moved by dragging them to a new position in the workflow.</li>
          </ul>
        </li>
      </ul>

      <StaticVideo url="https://assets.jdjfisher.dev/mia/guides/new-workflow/add_modules.mp4" />
    </section>

    <section class="space-y-4">
      <AnchoredHeading type="h2" text="Selecting files to process" />

      <ul>
        <li>
          Files or folders being processed are specified in the always-present
          <a class="link" href="/modules/core/input-control"> Input control </a>
          module, which can be found above the current workflow.
        </li>

        <li>
          The "Input path" parameter specifies either a file or folder that the analysis will be run
          on.
          <ul>
            <li>
              The selected file only acts to provide a root path from which the analysis runs. The
              image at this location isn't automatically loaded into the MIA workspace, instead this
              is done by a variety of image loading modules (see
              <a class="link" href="/modules/input-output"> Input/output </a>
              modules).
            </li>
            <li>
              This fine-grain control over image loading allows us to load sub-sets of image stacks
              (e.g. a single channel) and gives greater control of the images stored in memory at
              any given time.
            </li>
            <li>
              A copy of the
              <a class="link" href="/modules/input-output/load-image"> Load image </a>
              module is automatically included with all new workflows.
            </li>
          </ul>
        </li>

        <li>
          If a folder is selected, all files contained within (and within sub-folders) can be
          processed.
          <ul>
            <li>In this "batch" mode, only files matching specified filters will be processed.</li>
          </ul>
        </li>
      </ul>

      <StaticVideo url="https://assets.jdjfisher.dev/mia/guides/new-workflow/file_selection.mp4" />
    </section>

    <section class="space-y-4">
      <AnchoredHeading type="h2" text="Configuring modules" />

      <ul>
        <li>
          View the parameters associated with a module by clicking its name in the current workflow.
          <ul>
            <li>Parameters are grouped into sections, divided by blue headers.</li>
          </ul>
        </li>

        <li>
          Parameters can have many different types (e.g. text inputs, available objects or choices).
          <ul>
            <li>
              Generally, each parameter should only allow valid inputs. For example, object
              selectors will only show objects detected by preceding modules, but not those from
              subsequent modules.
            </li>
          </ul>
        </li>

        <li>
          Specific parameters can be added to
          <a class="link" href="/guides/processing-view"> processing view </a>
          by toggling the visibility button to the right of the parameter.
          <ul>
            <li>
              The <MiaIcon type="eye_open_black.png" /> icons indicates a visible (editable) parameter
              and <MiaIcon type="eye_closed_black.png" /> one that will not be visible.
            </li>
          </ul>
        </li>

        <li>
          It's also possible to allow modules to be disabled from processing view by selecting "Can
          be disabled" from the top of the parameter window.
          <ul>
            <li>
              When selected, a power icon (<MiaIcon type="power_bright_green.png" /> or
              <MiaIcon type="power_black_strike.png" />) will be displayed next to the module name
              in processing view.
            </li>
          </ul>
        </li>

        <li>Modules and parameters can be renamed by right-clicking on their name.</li>
      </ul>

      <StaticVideo
        url="https://assets.jdjfisher.dev/mia/guides/new-workflow/update_parameters.mp4"
      />
    </section>

    <section class="space-y-4">
      <AnchoredHeading type="h2" text="Configuring output results format" />

      <StaticVideo url="https://assets.jdjfisher.dev/mia/guides/new-workflow/set_results.mp4" />

      <li>
        The generated results spreadsheet can be configured in the always-present
        <a class="link" href="/modules/core/output-control"> Output control </a>
        module, which can be found above the current workflow.
        <ul>
          <li>
            Results spreadsheets will typically be stored in the same folder as the selected input
            file or within a selected input folder.
          </li>
        </ul>
      </li>

      <li>
        By default, all measurements will be included in the spreadsheet. These can be
        enabled/disabled individually from the "Measurement selection" section.
        <ul>
          <li>Each exported object collection will be given a separate sheet in the worksheet.</li>
          <li>
            Measurement names, which will be displayed at the top of each column, can be changed by
            right-clicking on the measurement name.
          </li>
        </ul>
      </li>

      <li>
        Measurements will also be summarised in a separate "Summary" sheet. This sheet can be
        enabled/disabled in the "Summary sheet" section.
        <ul>
          <li>
            A single summary is prepared for each processed image; however, this can be split down
            per timepoint.
          </li>
          <li>
            Each measurement can be summarised as the mean, minimum, maximum, standard deviation and
            sum.
          </li>
          <li>
            Individual measurement summaries can be enabled/disabled in the "Measurement selection"
            section.
          </li>
        </ul>
      </li>

      <li>
        More information on the results spreadsheet format can be found in the
        <a class="link" href="/guides/results-format"> Results format </a>
        guide.
      </li>
    </section>
  </div>
</GuideLayout>
